<!DOCTYPE HTML>
<html>
 <head>
  <title> Captivate </title>
  <meta name="Author" content="Aaron K. Murray, @aaronkmurray, akmurray@gmail.com">
  <meta name='special thanks' content='Jason Cavaliere, Andy Steinberg, Buildasign'>
  <meta name='copyright' content='all game stuff to the respective owners...like Nintendo'>
  <meta name='props' content='platforming physics inspired by nihilogic.dk'>
  <meta name='props' content='sound clips from themushroomkingdom.net/media/smb/wav'>
  <meta name='props' content='fonts from http://www.mariomayhem.com/downloads/super_mario_fonts/index.php'>
	

  <link rel="stylesheet" type="text/css" href="reset-min.css">

  <script src='jquery-1.9.1.js'></script>
  <script src='jquery.storage.js'></script>


<style>
html, body, #background {overflow:hidden;font-family:monospace, "Courier New", courier;font-weight:bold;}


#background {
	width : 100%;
	height : 100%;
	position : absolute;
	top : 0px;
	left : 0px;
	overflow-x : hidden;
	z-index : -10;
	

/*
	background: #6898F8;
	background: -moz-linear-gradient(-90deg, rgb(40,30,30), rgb(90,70,70));
	background: -webkit-gradient(linear, left top, left bottom, from(rgb(40,30,30)), to(rgb(90,70,70)));
*/
}

#background .level {
	position : absolute;
	bottom : -16px; /* this adjusts the bg img up/down, but changing it from -16px throws off the math...so just edit the bg image accordingly */
	left : 0px;
	margin-bottom: 0px;
	z-index : -9;

	/* this needs to be the size of bg.gif */
	height : 240px;
	width : 3840px;
	
	/* 
	height : 248px;
	width : 3392px;
	background-image : url(mariobackground.png); */
/*	overflow-x : hidden;*/
}

#background .overlay {
	width : 3840px;
	height : 100%;
	position : absolute;
	top : 0px;
	left : 0px;
	background-color : rgba(50,40,20,0.5);
}

#background .toon-sprite {
	width : 18px;
	height : 17px;
	overflow : hidden;
	position : absolute;
	left : -999px;
}

#background .slide-line {
	position : absolute;
	color:#333;
}

.debug-collisionmap-block {
	height:16px;
	width:16px;
	font-size:0.25em;
	position:absolute;
	overflow:hidden;
	display:block;
}
.debug-collisionmap-block.value0 {
}
.debug-collisionmap-block.value1 {
	background-color:red;
	opacity:0.6;
}
.debug-collisionmap-block.value2 {
	background-color:blue;
	opacity:0.6;
}
.debug-collisionmap-block:hover {
	background-color:yellow;
	opacity:0.5;
	cursor:crosshair;
}
.debug-collisionmap-block.value1:hover {
	background-color:pink;
}
.debug-collisionmap-block.value2:hover {
	background-color:lightblue;
}

#wrapper-debug {
	display:none;
	position:absolute:
	top:0;
	left:0;
}

.block {
	position:absolute;
}
.sprite {
	position:absolute;
}
.hidden {
	display:none;
}
#wrapper-debug .hidden {
	display:block;
}

.wrapper-textbox-theme0 {
	border: solid 1px black;
	background-color: #B3F3CC;
	padding:2px;
	font-family:"Courier New",courier;
}
.wrapper-textbox-theme1 {
	border: solid 1px black;
	background-color: #0860A8;
	padding:2px;
	font-family:"Courier New",courier;
}

.slide {
	z-index: 1000;
}
</style>

</head>



 <body>
	<div id='wrapper-debug'>
		<img id='imgDebugTile' src='clear.gif' style='border:solid 1px red' />
		<select id='selDebugTiles' onchange='game.handleSelDebugTilesChanged()'></select>
		<select id='selDebugBlockContents'></select>
	</div>
	<div id='background'>
		<div class='level'>
			<div class='toon-sprite'></div>
		</div>
	</div>
 </body>






<script>
var game = {};

$(document).ready(function() {

	game.isEditMode = false;

	game.audio = {}; //namespace obj

	var $background = $("#background");
	var $level = $("#background .level");
	var $toon = $("#background .level .toon-sprite");

	var slides = [null //level 0
		, [		{minCol:66, maxCol:70}
			, {minCol:74, maxCol:78}
			, {minCol:85, maxCol:89}
			, {minCol:105, maxCol:109}
			, {minCol:129, maxCol:133}
			, {minCol:163, maxCol:167}
			, {minCol:183, maxCol:187}
			, {minCol:198, maxCol:202}
		]			//level 1
		, [		{minCol:12, maxCol:16}
			, {minCol:26, maxCol:30}
			, {minCol:32, maxCol:36}
			, {minCol:47, maxCol:51}
			, {minCol:67, maxCol:71}
			, {minCol:103, maxCol:107}
			, {minCol:121, maxCol:125}
			, {minCol:145, maxCol:150}
		]			//level 2
	];



	//array of level objects. First el null on purpose. Index matches folder name in /level/# dir. Example: /level/1/
	var levels = [null, 
					{	themes:[
							{name:'nes', backgroundColor:'#5C94FC', toonSprites:["mario3sprite.png","mario1sprite.png"], 
								font: {filename:'font.png', codeOffset:32, height:8, width:8, rows:4, cols:16, convertLowerToUpper:true},
								audio: [
										 {key:'bg', filename:'bg.mp3', isLooping:false} 
										,{key:'1up', filename:'sfx/smb_1-up.wav', isLooping:false}
										,{key:'bowserfalls', filename:'sfx/smb_bowserfalls.wav', isLooping:false}
										,{key:'bowserfire', filename:'sfx/smb_bowserfire.wav', isLooping:false}
										,{key:'breakbrickblock', filename:'sfx/smb_breakblock.wav', isLooping:false}
										,{key:'bump', filename:'sfx/smb_bump.wav', isLooping:false}
										,{key:'coin', filename:'sfx/smb_coin.wav', isLooping:false}
										,{key:'fireball', filename:'sfx/smb_fireball.wav', isLooping:false}
										,{key:'fireworks', filename:'sfx/smb_fireworks.wav', isLooping:false}
										,{key:'flagpole', filename:'sfx/smb_flagpole.wav', isLooping:false}
										,{key:'gameover', filename:'sfx/smb_gameover.wav', isLooping:false}
										,{key:'jump-small', filename:'sfx/smb_jump-small.wav', isLooping:false}
										,{key:'jump-super', filename:'sfx/smb_jump-super.wav', isLooping:false}
										,{key:'kick', filename:'sfx/smb_kick.wav', isLooping:false}
										,{key:'mariodie', filename:'sfx/smb_mariodie.wav', isLooping:false}
										,{key:'pause', filename:'sfx/smb_pause.wav', isLooping:false}
										,{key:'pipe', filename:'sfx/smb_pipe.wav', isLooping:false}
										,{key:'powerup', filename:'sfx/smb_powerup.wav', isLooping:false}
										,{key:'powerup_appears', filename:'sfx/smb_powerup_appears.wav', isLooping:false}
										,{key:'stage_clear', filename:'sfx/smb_stage_clear.wav', isLooping:false}
										,{key:'stomp', filename:'sfx/smb_stomp.wav', isLooping:false}
										,{key:'vine', filename:'sfx/smb_vine.wav', isLooping:false}
										,{key:'warning', filename:'sfx/smb_warning.wav', isLooping:false}
										,{key:'world_clear', filename:'sfx/smb_world_clear.wav', isLooping:false}
								]}
						], 
						startPos: [1,12]
					},
					{	themes:[
							{name:'nes', backgroundColor:'#000000', toonSprites:["mario3sprite.png","mario1sprite.png"], 
								font: {filename:'font.png', codeOffset:32, height:8, width:8, rows:4, cols:16, convertLowerToUpper:true},
								audio: [
										 {key:'bg', filename:'bg.mp3', isLooping:false} 
										,{key:'1up', filename:'sfx/smb_1-up.wav', isLooping:false}
										,{key:'bowserfalls', filename:'sfx/smb_bowserfalls.wav', isLooping:false}
										,{key:'bowserfire', filename:'sfx/smb_bowserfire.wav', isLooping:false}
										,{key:'breakbrickblock', filename:'sfx/smb_breakblock.wav', isLooping:false}
										,{key:'bump', filename:'sfx/smb_bump.wav', isLooping:false}
										,{key:'coin', filename:'sfx/smb_coin.wav', isLooping:false}
										,{key:'fireball', filename:'sfx/smb_fireball.wav', isLooping:false}
										,{key:'fireworks', filename:'sfx/smb_fireworks.wav', isLooping:false}
										,{key:'flagpole', filename:'sfx/smb_flagpole.wav', isLooping:false}
										,{key:'gameover', filename:'sfx/smb_gameover.wav', isLooping:false}
										,{key:'jump-small', filename:'sfx/smb_jump-small.wav', isLooping:false}
										,{key:'jump-super', filename:'sfx/smb_jump-super.wav', isLooping:false}
										,{key:'kick', filename:'sfx/smb_kick.wav', isLooping:false}
										,{key:'mariodie', filename:'sfx/smb_mariodie.wav', isLooping:false}
										,{key:'pause', filename:'sfx/smb_pause.wav', isLooping:false}
										,{key:'pipe', filename:'sfx/smb_pipe.wav', isLooping:false}
										,{key:'powerup', filename:'sfx/smb_powerup.wav', isLooping:false}
										,{key:'powerup_appears', filename:'sfx/smb_powerup_appears.wav', isLooping:false}
										,{key:'stage_clear', filename:'sfx/smb_stage_clear.wav', isLooping:false}
										,{key:'stomp', filename:'sfx/smb_stomp.wav', isLooping:false}
										,{key:'vine', filename:'sfx/smb_vine.wav', isLooping:false}
										,{key:'warning', filename:'sfx/smb_warning.wav', isLooping:false}
										,{key:'world_clear', filename:'sfx/smb_world_clear.wav', isLooping:false}								
									]
								}
						], 
						startPos: [2,0]
					},
	]; 
	
	
	game.collisionMaps = []; //array index is level #
	//enable debug mode ( call game.debugOn() ) to modify the map
	//values are: 0=no collision, 1=solid block, 2=block downward movement
	//game.exportCollisionMap(true) will then print this line of code to the console...copy and paste it in here with the double quote wrapper
	game.collisionMaps[1] = [[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,2,2,2,2,2,2,2,2,2,2,2,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,0,0,0,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,1,1,0,0,0,0,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,2,2,2,2,2,2,2,2,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,2,2,2,2,2,2,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,1,1,0,0,0,0,1,0,0,1,0,0,1,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,1,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,1,1,0,0,0,0,0,0,0,0,1,1,1,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,2,2,2,2,2,2,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,0,0,1,1,1,0,0,0,0,0,0,1,1,1,1,0,0,1,1,1,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,1,1,1,1,1,0,0,1,1,1,1,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]];
	
	game.collisionMaps[2] = [[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,1,1,1,1,1,1,0,0,1,1,1,1,0,0,0,0,0,0,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,1,1,1,1,1,1,0,0,1,1,1,1,0,0,0,0,0,0,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,1,1,0,0,0,1,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,2,2,0,0,0,0,0,0,0,0,0,0,0,0,2,2,2,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,1,1,0,0,0,1,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,1,1,1,0,1,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,1,1,0,0,0,1,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1,0,0,1,0,1,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,1,1,0,0,0,1,0,1,0,0,1,1,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,1,1,1,1,1,0,0,0,0,0,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,0,0,1,1,1,0,0,0,0,0,1,1,1,1,0,0,1,1,1,1,1,1,0,0,0,1,1,1,0,0,1,1,0,0,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,0,1,0,1,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,1,1,1,0,0,2,2,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,0,0,1,1,0,0,1,1,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,0,1,0,1,0,1,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,1,1,0,0,0,0,1,1,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,0,0,1,1,0,0,1,1,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,0,1,0,1,0,1,0,1,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,1,1,0,0,0,0,1,1,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,0,0,1,1,0,0,1,1,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,1,1,0,0,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,0,0,2,2,2,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]];

	//when adding a new type, update the 3 'activated' arrays below and specialBlockActivated() function
	game.blockMaps = [];//game.blockMaps is an array of levels, each with array of subarrays. Each subarray element represents a block. 
	//Components are: [blockType, row, col, isDisabled, containsItemTypeId={1=1up,2=coin,3=star,4=mushroom,5=flower,6=mushroom or flower, 7=10 coin},isInvisible]
	//blockTypes: 1=?, 2=coin, 3=red brick, 4=P, 5=End-level Star/Flower/Mushroom anim, 6=1up, 7=music note, 8=empty block, 9=star, 10=flagpole, 11=blue brick, 12=spinning coin
	//NOTE: each time you add a new blockType - also update the game.handleMouseUpEvent() switch, and the specialBlockActivated() function
	//NOTE: when adding new options for containsItemTypeId, update the code that sets selDebugBlockContents options, and the specialBlockActivated() function

	//paste game.blockMaps[x] entries from the browser console after running game.exportBlockMaps()

	game.blockMaps[1] = [[1, 13, 44, false, 2], [1, 13, 49, false, 4], [1, 9, 50, false, 2], [1, 13, 51, false, 2], [1, 13, 92, false, 1, false], [1, 9, 122, false, 2, false], [1, 13, 129, false, 3, false], [1, 13, 134, false, 2, false], [1, 13, 137, false, 2, false], [1, 13, 140, false, 2, false], [1, 9, 137, false, 4, false], [1, 9, 157, false, 2, false], [1, 9, 158, false, 2, false], [1, 13, 198, false, 2, false], [3, 13, 48, false], [3, 13, 50, false], [3, 13, 52, false], [3, 13, 105, false, 1, false], [3, 13, 107, false, 1, false], [3, 9, 108, false, 1, false], [3, 9, 109, false, 1, false], [3, 9, 110, false, 1, false], [3, 9, 111, false, 1, false], [3, 9, 112, false, 1, false], [3, 9, 113, false, 1, false], [3, 9, 114, false, 1, false], [3, 9, 115, false, 1, false], [3, 9, 119, false, 1, false], [3, 9, 120, false, 1, false], [3, 9, 121, false, 1, false], [3, 13, 122, false, 1, false], [3, 13, 128, false, 1, false], [3, 13, 146, false, 1, false], [3, 9, 149, false, 1, false], [3, 9, 150, false, 1, false], [3, 9, 151, false, 1, false], [3, 13, 157, false, 1, false], [3, 13, 158, false, 1, false], [3, 9, 156, false, 1, false], [3, 9, 159, false, 4, false], [3, 13, 196, false, 1, false], [3, 13, 197, false, 1, false], [3, 13, 199, false, 1, false], [1, 13, 106, false, 4, false],[10,6,226,false,0,false],[10,7,226,false,0,false],[10,8,226,false,0,false],[10,9,226,false,0,false],[10,10,226,false,0,false],[10,11,226,false,0,false],[10,12,226,false,0,false],[10,13,226,false,0,false],[10,14,226,false,0,false],[10,15,226,false,0,false]];

	game.blockMaps[2] = [[1,13,92,false,1,true],[11,6,0,false,0,false],[1,13,11,false,2,false],[1,13,12,false,2,false],[1,13,13,false,2,false],[1,12,29,false,2,false],[11,12,73,false,7,false],[11,6,89,false,1,false],[11,6,90,false,0,false],[11,6,91,false,0,false],[11,6,92,false,0,false],[11,6,93,false,0,false],[11,6,137,false,0,false],[11,14,122,false,0,false],[11,14,123,false,0,false],[11,15,122,false,0,false],[11,15,123,false,0,false],[11,11,84,false,0,false],[11,11,85,false,0,false],[11,11,86,false,0,false],[11,11,87,false,0,false],[11,11,88,false,0,false],[11,11,89,false,0,false],[11,13,76,false,0,false],[11,13,77,false,0,false],[11,13,78,false,0,false],[11,13,79,false,0,false],[11,7,76,false,0,false],[11,7,77,false,0,false],[11,7,78,false,0,false],[11,7,79,false,0,false],[11,6,85,false,0,false],[11,6,86,false,0,false],[11,6,87,false,0,false],[11,6,88,false,0,false],[11,8,67,false,0,false],[11,13,68,false,0,false],[11,13,69,false,0,false],[11,7,66,false,0,false],[11,7,67,false,0,false],[11,7,68,false,0,false],[11,7,69,false,0,false],[11,6,19,false,0,false],[11,6,20,false,0,false],[11,6,21,false,0,false],[11,6,22,false,0,false],[11,6,23,false,0,false],[11,6,24,false,0,false],[11,6,25,false,0,false],[11,6,26,false,0,false],[11,6,27,false,0,false],[11,6,28,false,0,false],[11,6,29,false,0,false],[11,6,30,false,0,false],[11,6,53,false,0,false],[11,6,54,false,0,false],[11,6,55,false,0,false],[11,6,56,false,0,false],[11,6,57,false,0,false],[11,6,58,false,0,false],[11,6,59,false,0,false],[11,9,62,false,0,false],[11,10,62,false,0,false],[11,11,62,false,0,false],[11,12,62,false,0,false],[11,11,39,false,0,false],[11,12,39,false,0,false],[11,13,39,false,0,false],[11,13,40,false,0,false],[11,13,41,false,0,false],[11,11,41,false,0,false],[11,11,43,false,0,false],[11,11,44,false,0,false],[11,12,44,false,0,false],[11,13,44,false,0,false],[11,13,45,false,0,false],[11,13,46,false,0,false],[11,12,46,false,0,false],[11,6,7,false,0,false],[11,6,8,false,0,false],[11,6,9,false,0,false],[11,6,10,false,0,false],[11,6,11,false,0,false],[11,6,12,false,0,false],[11,6,13,false,0,false],[11,6,14,false,0,false],[11,6,15,false,0,false],[11,6,16,false,0,false],[11,6,17,false,0,false],[11,6,18,false,0,false],[11,12,41,false,0,false],[11,11,42,false,0,false],[11,13,54,false,0,false],[11,13,58,false,0,false],[11,13,59,false,0,false],[11,13,60,false,0,false],[11,13,61,false,0,false],[11,13,62,false,0,false],[11,9,67,false,0,false],[11,10,67,false,0,false],[11,11,67,false,0,false],[11,12,67,false,0,false],[11,6,31,false,0,false],[11,6,32,false,0,false],[11,6,33,false,0,false],[11,6,34,false,0,false],[11,6,35,false,0,false],[11,6,36,false,0,false],[11,6,37,false,0,false],[11,6,38,false,0,false],[11,6,39,false,0,false],[11,6,40,false,0,false],[11,6,41,false,0,false],[11,6,42,false,0,false],[11,6,43,false,0,false],[11,6,44,false,0,false],[11,6,45,false,0,false],[11,6,46,false,0,false],[11,6,47,false,0,false],[11,6,48,false,0,false],[11,6,49,false,0,false],[11,6,50,false,0,false],[11,6,51,false,0,false],[11,6,52,false,0,false],[11,6,60,false,0,false],[11,6,61,false,0,false],[11,6,62,false,0,false],[11,6,63,false,0,false],[11,6,64,false,0,false],[11,6,65,false,0,false],[11,6,66,false,0,false],[11,6,67,false,0,false],[11,6,68,false,0,false],[11,6,69,false,0,false],[11,6,70,false,0,false],[11,6,71,false,0,false],[11,6,73,false,0,false],[11,6,74,false,0,false],[11,6,75,false,0,false],[11,6,76,false,0,false],[11,6,77,false,0,false],[11,6,78,false,0,false],[11,6,79,false,0,false],[11,6,80,false,0,false],[11,6,81,false,0,false],[11,6,82,false,0,false],[11,6,83,false,0,false],[11,6,84,false,0,false],[11,12,145,false,0,false],[11,12,146,false,0,false],[11,12,147,false,0,false],[11,12,148,false,0,false],[11,6,94,false,0,false],[11,6,95,false,0,false],[11,6,96,false,0,false],[11,6,97,false,0,false],[11,6,98,false,0,false],[11,6,99,false,0,false],[11,6,100,false,0,false],[11,6,101,false,0,false],[11,6,102,false,0,false],[11,6,103,false,0,false],[11,6,104,false,0,false],[11,6,105,false,0,false],[11,6,106,false,0,false],[11,6,107,false,0,false],[11,6,108,false,0,false],[11,6,109,false,0,false],[11,6,110,false,0,false],[11,6,111,false,0,false],[11,6,112,false,0,false],[11,6,113,false,0,false],[11,6,114,false,0,false],[11,6,115,false,0,false],[11,6,116,false,0,false],[11,6,117,false,0,false],[11,6,118,false,0,false],[11,6,119,false,0,false],[11,6,120,false,0,false],[11,6,121,false,0,false],[11,6,122,false,0,false],[11,6,123,false,0,false],[11,6,124,false,0,false],[11,6,125,false,0,false],[11,6,126,false,0,false],[11,6,127,false,0,false],[11,6,128,false,0,false],[11,6,129,false,0,false],[11,6,130,false,0,false],[11,6,131,false,0,false],[11,6,132,false,0,false],[11,6,133,false,0,false],[11,6,134,false,0,false],[11,6,135,false,0,false],[11,6,136,false,0,false],[11,6,161,false,0,false],[11,6,162,false,0,false],[11,6,163,false,0,false],[11,6,164,false,0,false],[11,6,165,false,0,false],[11,6,170,false,0,false],[11,6,171,false,0,false],[11,6,172,false,0,false],[11,6,173,false,0,false],[11,6,174,false,0,false],[11,6,175,false,0,false],[11,6,176,false,0,false],[11,6,177,false,0,false],[11,6,178,false,0,false],[11,6,179,false,0,false],[11,6,180,false,0,false],[11,6,181,false,0,false],[11,6,182,false,0,false],[11,6,183,false,0,false],[11,6,184,false,0,false],[11,6,185,false,0,false],[11,12,150,false,6,false],[11,11,46,false,3,false],[11,8,76,false,0,false],[11,8,77,false,0,false],[11,8,78,false,0,false],[11,8,79,false,0,false],[11,7,54,false,0,false],[11,7,55,false,0,false],[11,8,54,false,0,false],[11,8,55,false,0,false],[11,9,52,false,0,false],[11,10,52,false,0,false],[11,11,52,false,0,false],[11,12,52,false,0,false],[11,12,53,false,0,false],[11,11,53,false,0,false],[11,10,53,false,0,false],[11,9,53,false,0,false],[11,13,52,false,0,false],[11,13,53,false,0,false],[11,13,55,false,0,false],[11,14,54,false,0,false],[11,14,55,false,0,false],[11,15,54,false,0,false],[11,15,55,false,0,false],[11,7,58,false,0,false],[11,7,59,false,0,false],[11,7,60,false,0,false],[11,7,61,false,0,false],[11,7,62,false,0,false],[11,7,63,false,0,false],[11,8,58,false,0,false],[11,8,59,false,0,false],[11,8,60,false,0,false],[11,8,61,false,0,false],[11,8,62,false,0,false],[11,8,63,false,0,false],[11,9,63,false,0,false],[11,10,63,false,0,false],[11,11,63,false,0,false],[11,12,63,false,0,false],[11,13,63,false,0,false],[11,8,66,false,0,false],[11,8,68,false,0,false],[11,8,69,false,0,false],[11,9,72,false,0,false],[11,9,73,false,0,false],[11,10,72,false,0,false],[11,10,73,false,0,false],[11,11,72,false,0,false],[11,11,73,false,0,false],[11,12,72,false,0,false],[11,13,72,false,0,false],[11,13,73,false,0,false],[11,16,122,false,0,false],[11,16,123,false,0,false],[11,12,149,false,0,false],[11,6,166,false,0,false],[11,6,167,false,0,false],[11,6,186,false,0,false],[11,6,6,false,0,false],[12,12,40,false,0,false],[12,12,45,false,0,false],[12,12,58,false,0,false],[12,12,59,false,0,false],[12,12,60,false,0,false],[12,12,61,false,0,false],[12,12,68,false,0,false],[11,12,69,false,4,false],[12,9,84,false,0,false],[12,9,85,false,0,false],[12,9,86,false,0,false],[12,9,87,false,0,false],[12,9,88,false,0,false],[12,9,89,false,0,false],[11,6,72,false,1,false],[1,13,10,false,4,false],[1,13,14,false,2,false],[12,9,41,false,0,false],[12,9,42,false,0,false],[12,9,43,false,0,false],[12,9,44,false,0,false]];

	//see blockTypes list above
	game.blockTypesActivatedFromAnyDir = [2,6,10,12];
	game.blockTypesActivatedFromAbove = [4];
	game.blockTypesActivatedFromBelow = [1,2,3,5,7,11];


	var currentLevel = 1;
	var currentThemeNum = 0;
	var currentToonNum = 0;

	game.startedBgMusic = [];
	for (var i=0;i<levels.length;i++)
		game.startedBgMusic[i] = false;

	game.loadSavedData = function() {
		var savedMaps = $.localStorage('collisionMaps');	
		if (savedMaps && savedMaps.length > 0)
			game.collisionMaps = savedMaps;
	};
	game.loadSavedData();

	game.getLevelThemePath = function(levelNum, themeNum) {
		var level = (levelNum || currentLevel);
		var theme = (themeNum || currentThemeNum);
		var path = 'level/' + level + '/theme/' + levels[level].themes[theme].name + '/';
		//log(path, levelNum, themeNum);
		return path;
	};


	game.loadLevelBlockMap = function(levelNum, themeNum) {
		var rows = game.collisionMaps[levelNum].length;
		for (var i=0;i<game.blockMaps[levelNum].length;i++)
		{
		    game.loadLevelBlock(levelNum, themeNum, i, rows);
		}
	};

	game.loadLevelBlock = function (levelNum, themeNum, blockIndex, rows) {

	    var block = game.blockMaps[levelNum][blockIndex];
	    if (!block) //not a block
	        return;

		//block[5] is invisible

	    var img = new Image();
	    img.src = game.getLevelThemePath(levelNum, themeNum) + 'icon-'+block[0]+'.gif';
	    img.className = 'block block-' + block[0] + ' block-r' + block[1] + 'c' + block[2];
	    img.blockType = block[0];
		if (block[5])
		    img.className += ' hidden';
	    $(img).css("bottom",  (rows - block[1])*16).css("left", block[2]*16);
	    $level.append(img);

	};

	game.loadLevel = function(levelNum, themeNum, playBgMusic) {
		this.isLevelEnding = false;
		var level = (levelNum || currentLevel);
		var theme = (themeNum || currentThemeNum);
		currentLevel = level;
		currentThemeNum = theme;

		if (playBgMusic)
			game.audio.playBgMusic();

		//TODO remove previous level's blocks
		$('.block').remove();

		game.loadLevelBackground(level, theme);
		vel = [0,0]; //stop movement
		game.stopToon();
		game.setToonPosition(levels[currentLevel].startPos);
		setToonImage(spriteStates.JUMPRIGHT);
		scrollPosX = 0;
		scrollSpeed = 0;
		$background[0].scrollLeft=0; //reset screen back to beginning of bg

		$('.toon-sprite').show();

	


		game.loadLevelBlockMap(level, theme);


		//TODO render text? game.renderFont('howdy', 16, 32)
		if (level == 1)
		{
			game.renderFont('@aaronkmurray', 32, 138, 'level1-text1')
			game.renderFont('captivate 2013', 160, 171, 'level1-text2')
		} else {
			$('#level1-text1').remove();
			$('#level1-text2').remove();
		}

	};

	game.updateBlockSprites = function(levelNum, themeNum) {
		var blockImgs = $('img.block');
		for (var i=0;i<blockImgs.length;i++)
		{
			var img = blockImgs[i];
			if (!isNaN(img.blockType))
			{
				img.src = game.getLevelThemePath(levelNum, themeNum) + 'icon-'+img.blockType+'.gif';
			}
		}
	};
	
	var toonImg = new Image();
	$toon.append(toonImg);

	game.setToonSpriteSet = function(toonNum, levelNum, themeNum) {
		//Set the current toon sprite tileset given an index to our possible character sprites in the toonSpriteSets array
		var level = (levelNum || currentLevel);
		var theme = (themeNum || currentThemeNum);
		currentToonNum = toonNum;
		toonImg.src = game.getLevelThemePath(level, theme) + levels[level].themes[theme].toonSprites[currentToonNum];
	};


	game.loadLevelBackground = function(levelNum, themeNum) {
		$background.css('background-color', levels[levelNum].themes[themeNum].backgroundColor);
		$level.css('background-image', 'url(\"' + game.getLevelThemePath(levelNum, themeNum) + 'bg.gif\")');
		//$level.css('background-position', '0px -16px');
	};



	

	var pos = [];//will be set by level[1].startPos when level data is loaded  //[1,25]; //[8,game.collisionMaps[1].length - $(window).height()/16];
	var vel = [0,0];
	var velMax = [0.4,0.8];
	var velMin = [-0.4,-0.85];
	var toonDir = 0;
	var onGround = false;
	var toonFaceDir = 1;

	var scrollPosX = 0;
	var scrolling = false;
	var scrollSpeed = 0;

	var mouse = []; //array of objects - index represents a mouse button

	var keyQueue = []; //ordered array of last X keypresses (for monitoring special 'code' sequences)
	var keyQueueMax = 16; //max number of keypresses to watch for

	var idleTime = 60000;
	var lastActionTime;
	
	var _coins = 0;

    game.audio.context = null;	//will be set in initAudio;
	game.audio.sounds = {}; //key: soundKey string, value: object {buffer: AudioBuffer, gainNode: Gain} ... see playSound() && playBuffer()

	function log() {
		if (console && console.log)
			console.log(arguments);
		else if (game.isEditMode)
			$('body').append($('<div>'+arguments+'<div>'));
	}
	
	

	game.setToonPosition = function(arrNewPos /*[col, row]*/) {
		if (arguments.length == 2)
			pos = [arguments[0],arguments[1]];
		else
			pos = arrNewPos;
		$toon
			.css("left", pos[0]*16)
			.css("bottom", game.collisionMaps[currentLevel].length*16 - pos[1]*16)
		;
	};	

	function checkIdle() {

		return; //TODO

		var now = new Date().getTime();
		if (now - lastActionTime > idleTime) {
			if (onGround) 
				vel[1] = velMin[1];
			lastActionTime = now;
		}
	}

	function setToonImage(idx) {
		$toon.scrollLeft((0+idx) + (idx*17)); //17 is 1 less than the frame width in the sprite
	}

	var spriteStates = {
		JUMPLEFT1 : 0,
		JUMPLEFT2 : 1,
		RUNLEFT3 : 2,
		RUNLEFT2 : 3,
		RUNLEFT1 : 4,
		STANDLEFT : 5,
		STANDRIGHT : 6,
		RUNRIGHT1 : 7,
		RUNRIGHT2 : 8,
		RUNRIGHT3 : 9,
		JUMPRIGHT2 : 10,
		JUMPRIGHT1: 11
	}


	function mainLoop() {

		//First set of steps is to check for end game, and end-level scenarios...basically in reverse play order
		
		//check end-levels
		if (currentLevel == 1)
		{
			if (pos[0] >= 231.5) //at the castle entrance
			{
				//make him disappear
				if (game.isLevelEnding)	{
					game.hideToon();
					game.handleLevelHasEnded();
				}
				return;
			} 
			if (pos[0] >= 227) //past the flagpole
			{
				//make him walk towards the castle
				game.moveToonRight();
			} 
			else if (game.isLevelEnding) //sliding down the pole
			{
				//we want to control mario now
				if (pos[0] < 226 && pos[1] > 15)
				{
					//he is at the base of the flagpole
					game.setToonPosition([227,15]);
					setToonImage(spriteStates.JUMPLEFT);
					return;
				}
			}

				//check to see if we started the bg music for lvl 1...start after we walk past the main screen area
			if (pos[0] >= 16 && !game.startedBgMusic[1])
			{
				game.startedBgMusic[1] = true;
				game.audio.playBgMusic(1);
			}
		}

		

		//see if we should draw slides
		if (!game.isLevelEnding && slides[currentLevel])
		{
			for (var i=0;i<slides[currentLevel].length; i++ )
			{
				var slide = slides[currentLevel][i];
				if (!slide)
					continue;
				if (slide.minCol >= (pos[0] +1) || slide.maxCol < pos[0])
				{
					game.hideSlide(currentLevel, i);
					continue;
				}

				game.showSlide(currentLevel, i);
			}
		}


		var velIncX = 0.05;
		var walkCycleLoopLeft = [spriteStates.RUNLEFT1, spriteStates.RUNLEFT2];
		var walkCycleLoopRight = [spriteStates.RUNRIGHT1, spriteStates.RUNRIGHT2];

		if (toonDir) {
			toonFaceDir = toonDir;
			vel[0] += velIncX * toonDir;
		} else {
			vel[0] *= 0.8;
			if (Math.abs(vel[0]) < 0.05) vel[0] = 0;
		}

		vel[1] += 0.08;
		if (vel[0] > velMax[0]) vel[0] = velMax[0];
		if (vel[0] < velMin[0]) vel[0] = velMin[0];
		if (vel[1] > velMax[1]) vel[1] = velMax[1];
		if (vel[1] < velMin[1]) vel[1] = velMin[1];

		var newPos = [
			pos[0] + vel[0],
			pos[1] + vel[1]
		];

		if (onGround) {
			if (vel[0] == 0) {
				walkCycle = 0;
				setToonImage(toonFaceDir < 0 ? spriteStates.STANDLEFT : spriteStates.STANDRIGHT);
			} else {
				walkCycle += 0.5;
				if (walkCycle >= walkCycleLoopLeft.length) 
					walkCycle = 0;
				setToonImage(vel[0] < 0 ? walkCycleLoopLeft[Math.floor(walkCycle)] : walkCycleLoopRight[Math.floor(walkCycle)]);
			}
		} else {
			walkCycle = 0;
			setToonImage(toonFaceDir < 0 ? spriteStates.JUMPLEFT1 : spriteStates.JUMPRIGHT1);
		}

		pos = collide(pos, newPos);	

		if (pos[0] != newPos[0]) vel[0] = 0;
		if (pos[1] != newPos[1]) vel[1] = 0;

		//$(window).width()/16 is the number of columns showing
		var winColsShowing = $(window).width()/16;

		if (pos[1] > game.collisionMaps[currentLevel].length) 
			pos[1] = game.collisionMaps[currentLevel].length - winColsShowing;

		//scrollPosX/16 is the column that we are showing on screen
		var curScrollCol = scrollPosX/16;
		if (toonFaceDir > 0 && pos[0] > winColsShowing - (winColsShowing/2) + curScrollCol)
			initScroll(1);
		else if (toonFaceDir < 0 && pos[0] < (winColsShowing/4) + curScrollCol)
			initScroll(-1);

		$toon
			.css("left", pos[0]*16)
			.css("bottom", game.collisionMaps[currentLevel].length*16 - pos[1]*16)
		;
	}

	function initScroll(dir) {
		scrollSpeed = dir;
		if (scrolling) 
			return;
		scrolling = true;
		scroll();
	}

	function scroll() {
		//log('scroll', $background[0].scrollLeft, scrollPosX, scrollSpeed, pos, vel);
		$background.scrollLeft(scrollPosX + ($(window).width()/16/2) * scrollSpeed);
		scrollSpeed *= 0.93; //0.92 is good. 0.99 leaves toon off the screen. 0.95 is a max

		scrollPosX = $background.scrollLeft();
		if (Math.abs(scrollSpeed) > 0.1)
			setTimeout(scroll, 1000 / 20); //1000 / 15
		else
			scrolling = false;

	}



	function collide(pos1, pos2) {
		var oldX = pos1[0];
		var oldY = pos1[1];
		var newX = pos2[0];
		var newY = pos2[1];

		var collision, xAdjust = 0;

		var space = 1/16; //this is the amount of 'no hit' part of the block to allow for. 1/16 is default

		onGround = false;

		if (oldY != newY) { // moving vertically
			if (newY > oldY) { // moving down
				// lower left collision

				var checkForSpecialBlockHit = false;

				collision = isBlocking(newX + space, newY + 1,[]);
				if (collision && !isBlocking(newX + space, newY,[])) {
					newY -= collision[1];
					onGround = true;
					checkForSpecialBlockHit = true;
				}

				var collisionData = collision;

				// lower right collision
				collision = isBlocking(newX + 1-space, newY + 1,[]);
				if (collision && !isBlocking(newX + 1-space, newY,[])) {
					newY -= collision[1];
					onGround = true;
					checkForSpecialBlockHit = true;
					collisionData = collision;
				}
			

				//TODO for game.blockTypesActivatedFromAbove = [4];

			} else { 
				// moving up
				var checkForSpecialBlockHit = false;

				// upper left collision
				collision = isBlocking(newX + space, newY,[2]);
				if (collision && !isBlocking(newX + space, newY + 1,[2])) {
					newY += (1 - collision[1]);
					checkForSpecialBlockHit = true;
				}

				var collisionData = collision;
				// upper right collision
				collision = isBlocking(newX + 1 - space, newY,[2]);
				if (collision && !isBlocking(newX + 1 - space, newY + 1,[2])) {
					newY += (1 - collision[1]);
					xAdjust = 1;
					checkForSpecialBlockHit = true;
					collisionData = collision;
				}

				if (checkForSpecialBlockHit) {
					//log('checkForSpecialBlockHit', collisionData);

					//TODO need a way of checking for special created blocks - like 1ups, mushrooms, fire flowers, etc
					//TODO need a way to check for enemies

					//we go through every block in the map and find the first one that matches the row/col
					for (var bm = 0; bm < game.blockMaps[currentLevel].length; bm++) {
						var blockData = game.blockMaps[currentLevel][bm];
						if (!blockData) //invalid
							continue;

						//blockData[0] is the blockType 
	//Components are: [blockType, row, col, isDisabled, containsItemTypeId={1=1up,2=coin,3=star,4=mushroom,5=flower,6=mushroom or flower, 7=10 coin},isInvisible]
	//blockTypes: 1=?, 2=coin, 3=red brick, 4=P, 5=End-level Star/Flower/Mushroom anim, 6=1up, 7=music note, 8=empty block, 9=star, 10=flagpole, 11=blue brick, 12=spinning coin

/*
	do we really need this? ...I think it was originally intended to be a shortcut?
						if ($.inArray(blockData[0], game.blockTypesActivatedFromBelow) < 0 &&
							$.inArray(blockData[0], game.blockTypesActivatedFromAbove) < 0 &&
							$.inArray(blockData[0], game.blockTypesActivatedFromAnyDir) < 0 
						)
							continue; //this block type isn't activated
*/

						//collisionData[3] is abs column
						//collisionData[4] is abs row
						if (blockData[1] == collisionData[4] && blockData[2] == collisionData[3]) //row and col matches 
						{
							if (blockData[3]) {
								//disabled
								game.audio.playSfx('bump');
							} else {
								//type and row and col match and not disabled - take action on this block type/location: 
								var result = game.specialBlockActivated(blockData);
								blockData[0] = result.newBlockType; 
								blockData[3] = result.isDisabled;
								break;
							}
						}
					}
				}
			}

		}

		// moving horizontally
		if (oldX != newX) {

			// moving right
			if (newX > oldX) {

				// lower right collision
				collision = isBlocking(newX + 1, newY + 1-space, [2]);
				if (collision) {
					newX -= collision[0];
				}

				// upper right collision
				collision = isBlocking(newX + 1, newY, [2]);
				if (collision) {
					newX -= collision[0];
				}

				//TODO for
			
			} else { 
				// moving left

				// lower left collision
				collision = isBlocking(newX, newY + 1-space, [2]);
				if (collision) {
					newX += (1 - collision[0]);
				}

				// upper left collision
				collision = isBlocking(newX, newY, [2]);
				if (collision) {
					newX += (1 - collision[0]);
				}

				//TODO for

			}
		}

		var posToCheck = [];
		posToCheck.push([pos2[1],pos2[0]]);
		posToCheck.push([pos2[1]-0.5,pos2[0]-0.5]);
		posToCheck.push([pos2[1]+0.5,pos2[0]+0.5]);

		for(var i=0;i<posToCheck.length;i++) {
			var currentSpecialBlock = game.getActiveSpecialBlockAtLocation(posToCheck[i][0] /*row*/,  posToCheck[i][1] /*col*/);
			//game.blockTypesActivatedFromAnyDir = [2,6];
			if (currentSpecialBlock != null && $.inArray(currentSpecialBlock[0], game.blockTypesActivatedFromAnyDir) >= 0)
			{
				var result = game.specialBlockActivated(currentSpecialBlock);
				currentSpecialBlock[0] = result.newBlockType;
				currentSpecialBlock[3] = result.isDisabled;
				break;
			}
		}


		return [newX,newY,xAdjust];
	}

	// check if a tile is a blocking tile
	function isBlocking(x, y, arrNonBlockingTypes) {
		var tx = x>>0;
		var ty = y>>0;

		if (!game.collisionMaps[currentLevel][ty])
			return false; //undefined top or bottom of level

		var blockType = game.collisionMaps[currentLevel][ty][tx];
		if (typeof blockType == "undefined" || blockType > 0) {
			if ($.inArray(blockType, arrNonBlockingTypes) < 0) {
				return [x - tx, y - ty, blockType, tx, ty];
			}
		}
		return false;
	}

	game.hideToon = function() {
		$('.toon-sprite').hide();
	};
	
	game.showSlide = function(level, slideNum){
		$('#slide-' + level + '-' + slideNum).show();
	};
	game.hideSlide = function(level, slideNum){
		$('#slide-' + level + '-' + slideNum).hide();
	};

	game.buildSlides = function() {
		for (var l=0;l<slides.length; l++ )
		{
			if (!slides[l])
				continue;

			for (var i=0;i<slides[l].length; i++)
			{
				var slide = slides[l][i];
				if (!slide)
					continue;
				var src = game.getLevelThemePath(l, currentThemeNum) + 'slide-'+l+'-'+(i)+'.png';
				var x = (slide.minCol * 16) + 64;
				var y = 24;
				var slideHtml = '<img src="'+src+'" id="slide-'+l+'-'+(i)+'" class="slide" style="display:none;position:absolute;bottom:'+y+'px;left:'+x+'px;" />';
				var $slide = $(slideHtml);
				$level.append($slide);
			}
		}
	}

	game.getActiveSpecialBlockAtLocation = function(row, col) {
		//if (vel[0] != 0 || vel[1] != 0.08)
		//	log('game.getActiveSpecialBlockAtLocation', row, col, row>>0, col>>0, Math.round(row), Math.round(col), vel[0], vel[1]);

		row = Math.round(row);
		col = Math.round(col);

		for (var bm = 0; bm < game.blockMaps[currentLevel].length; bm++) {
			var blockData = game.blockMaps[currentLevel][bm];
			if (!blockData)
				continue;
			if (blockData[1] == row && blockData[2] == col)
			{
				if (!blockData[3]) {
					return blockData;
				}
			}
		}
		return null;
	};

	game.renderCoinPopAnim = function(row, col) {
		var rows = game.collisionMaps[currentLevel].length;

		//play coin pop animation
		var img = new Image();
		img.src = game.getLevelThemePath(currentLevel, currentThemeNum) + 'icon-2.gif';
		img.className = 'sprite effect-coin-pop-row'+row+'-col'+col;
		var $img = $(img);
		var y = (rows - row)*16;
		var x = col*16;

		//log('renderCoinPopAnim', row, col, x, y);

		$img.css("bottom", y).css("left", x);
		$level.append(img);

		// animate and remove
		$img.animate({bottom: "+=64px"}, {
										duration: 250,
										specialEasing: {
										  top: "linear"
										}, 
										complete: function() {
											// Animation complete.
											$(this).animate({bottom: "-=64px"}, {duration: 250, specialEasing: {top: "linear"}, 
												complete: function() {	
													$(this).remove()
												}
											});
										}
									});
	};

	game.render1upRevealAnim = function(row, col) {
		var rows = game.collisionMaps[currentLevel].length;

		//push 1up out of block
		var img = new Image();
		img.src = game.getLevelThemePath(currentLevel, currentThemeNum) + 'icon-6.gif';
		img.className = 'sprite sprite-row'+row+'-col'+col;
		var $img = $(img);
		var y = ((rows - row)*16)+8;
		var x = col*16;

		//log('renderCoinPopAnim', row, col, x, y);

		$img.css("bottom", y).css("left", x).css("z-index", -2);
		$level.append(img);

		// animate and remove
		$img.animate({bottom: "+=8px"}, {
										duration: 500,
										specialEasing: {
										  top: "linear"
										}, 
										complete: function() {
											// reveal complete.
											//TODO make this thing move around
										}
									});	
	};

	game.renderMushroomRevealAnim = function(row, col) {
		var rows = game.collisionMaps[currentLevel].length;

		//push 1up out of block
		var img = new Image();
		img.src = game.getLevelThemePath(currentLevel, currentThemeNum) + 'icon-5.gif';
		img.className = 'sprite sprite-row'+row+'-col'+col;
		var $img = $(img);
		var y = ((rows - row)*16)+8;
		var x = col*16;

		//log('renderCoinPopAnim', row, col, x, y);

		$img.css("bottom", y).css("left", x).css("z-index", -2);
		$level.append(img);

		// animate and remove
		$img.animate({bottom: "+=8px"}, {
										duration: 500,
										specialEasing: {
										  top: "linear"
										}, 
										complete: function() {
											// reveal complete.
											//TODO make this thing move around
										}
									});	
	};

	game.renderStarRevealAnim = function (row, col) {
	    var rows = game.collisionMaps[currentLevel].length;

	    //push star out of block
	    var img = new Image();
	    img.src = game.getLevelThemePath(currentLevel, currentThemeNum) + 'icon-9.gif';
	    img.className = 'sprite sprite-row' + row + '-col' + col;
	    var $img = $(img);
	    var y = (rows - row) * 16;
	    var x = col * 16;

	    //log('renderCoinPopAnim', row, col, x, y);

	    $img.css("bottom", y).css("left", x).css("z-index", -2);
	    $level.append(img);

	    // animate and remove
	    $img.animate({ bottom: "+=16px" }, {
	        duration: 500,
	        specialEasing: {
	            top: "linear"
	        },
	        complete: function () {
	            // reveal complete.
	            //TODO make this thing move around
	        }
	    });
	};


	game.renderBlockBumpAnim = function(img) {
		log('renderBlockBumpAnim', img);
		$(img).animate({bottom: "+=12px"}, {
										duration: 50,
										specialEasing: {
										  top: "linear"
										}, 
										complete: function() {
											// Animation complete.
											$(this).animate({bottom: "-=12px"}, {duration: 50, specialEasing: {top: "linear"}, 
												complete: function() {	
													
												}
											});
										}
									});
	};

	game.renderBrickBreakAnim = function(row, col) {
		log('TODO renderBrickBreakAnim', row, col);

		
		var y = (rows - row)*16;
		var x = col*16;

		var imgHtml = "<img src='"+game.getLevelThemePath(currentLevel, currentThemeNum) + "brick-chunk.gif' class='sprite effect-brick-break-chunk' />";

		var $imgTL = $(imgHtml).css("bottom", y).css("left", x);
		var $imgTR = $(imgHtml).css("bottom", y).css("left", x);
		var $imgBL = $(imgHtml).css("bottom", y).css("left", x);
		var $imgBR = $(imgHtml).css("bottom", y).css("left", x);

/*
		$(img).animate({bottom: "+=12px"}, {
										duration: 50,
										specialEasing: {
										  top: "linear"
										}, 
										complete: function() {
											// Animation complete.
											$(this).animate({bottom: "-=12px"}, {duration: 50, specialEasing: {top: "linear"}, 
												complete: function() {	
													
												}
											});
										}
									});
								*/
	};


	game.specialBlockActivated = function(blockData) {
		log('specialBlockActivated', blockData);
		var type = blockData[0];
		var row = blockData[1];
		var col = blockData[2];
		var isDisabled = blockData[3];
		var containedItemTypeId = blockData[4]; //coin, flower, etc

	//Components are: [blockType, row, col, isDisabled, containsItemTypeId={1=1up,2=coin,3=star,4=mushroom,5=flower,6=mushroom or flower, 7=10 coin},isInvisible]
	//blockTypes: 1=?, 2=coin, 3=red brick, 4=P, 5=End-level Star/Flower/Mushroom anim, 6=1up, 7=music note, 8=empty block, 9=star, 10=flagpole, 11=blue brick, 12=spinning coin

		switch (type) {
			case 1:		// "?" block
				//TODO coins or mushroom or fire or star or ?

				isDisabled = true;
				//update the sprite to a new "used/empty" type
				var img = $('.block-r' + row + 'c' + col)[0];
				type = 8;
				img.src = game.getLevelThemePath(currentLevel, currentThemeNum) + 'icon-'+type+'.gif';
				img.className = 'block block-' + type + ' block-r' + row + 'c' + col;

				if (containedItemTypeId == 1)			//1up
				{
					game.audio.playSfx('powerup_appears');
					game.render1upRevealAnim(row, col);
				} 
				else if (containedItemTypeId == 2)		//coin
				{
					_coins++;
					game.audio.playSfx('coin');
					game.renderBlockBumpAnim(img);
					game.renderCoinPopAnim(row - 1, col);
				} 
				else if (containedItemTypeId == 3)		//star
				{
					game.audio.playSfx('powerup_appears');
					game.renderBlockBumpAnim(img);
					game.renderStarRevealAnim(row, col)
				}
				else if (containedItemTypeId == 4) {	//mushroom
				    game.audio.playSfx('powerup_appears');
				    game.renderBlockBumpAnim(img);
				    game.renderMushroomRevealAnim(row, col)
				}
				else if (containedItemTypeId == 5) {	//fireflower
				    game.audio.playSfx('powerup_appears');
				    game.renderBlockBumpAnim(img);
				    game.renderMushroomRevealAnim(row, col)
				}
				else if (containedItemTypeId == 6) {	//mushroom or fireflower
				    game.audio.playSfx('powerup_appears');
				    game.renderBlockBumpAnim(img);
				    game.renderMushroomRevealAnim(row, col)
				}
				else if (containedItemTypeId == 7) {	//TODO 10-coins .... need to have a timestamp for when this was first activated and then expire it after a certian amount of time
					_coins++;
				    game.audio.playSfx('coin');
				    game.renderBlockBumpAnim(img);
					game.renderCoinPopAnim(row - 1, col);
				}
				break;
			case 2:		//coin

				// remove sprite and add to inventory 
				_coins++;
				isDisabled = true;
				game.audio.playSfx('coin');
				$('.block-r'+row+'c'+col).remove();
				break;
			case 3:		//red brick

				//TODO break when big
				//game.audio.playSfx('breakbrickblock');
				//game.renderBrickBreakAnim(row - 1, col);
				

				//small
				game.audio.playSfx('bump'); //TODO check for mushrooms/enemies on top and make them bounce up

				//update the sprite to a new "used/empty" type
				var img = $('.block-r' + row + 'c' + col)[0];
				game.renderBlockBumpAnim(img);

				break;
			case 11:	//blue brick

				//TODO break when big
				//game.audio.playSfx('breakbrickblock');
				//game.renderBrickBreakAnim(row - 1, col);
				

				//small
				game.audio.playSfx('bump'); //TODO check for mushrooms/enemies on top and make them bounce up

				//update the sprite to a new "used/empty" type
				var img = $('.block-r' + row + 'c' + col)[0];
				game.renderBlockBumpAnim(img);
			
				break;
			case 4:		//P
				//TODO smb3

				break;
			case 5:		//card: End-level Star/Flower/Mushroom
				//TODO smb3

				break;
			case 6:		//1up
				//TODO 
				isDisabled = true;
				game.audio.playSfx('1up');
				$('.block-r'+row+'c'+col).remove();
				break;
			case 7:		//music note
				//TODO play level intro music and setTimeout for bg
				game.audio.toggleBgMusic();
				break;
			case 10:	//flag pole
				//TODO play level end music, (fireworks?), and setTimeout for next level activation
				game.handleLevelEnding();
				break;
			//case 11: see above
			case 12:		//spinning coin

				// remove sprite and add to inventory 
				_coins++;
				isDisabled = true;
				game.audio.playSfx('coin');
				$('.block-r'+row+'c'+col).remove();
				break;
			default:
				log('unknown special block hit: ' + type);
		}
		return {isDisabled: isDisabled, newBlockType: type};
	};


	game.handleLevelEnding = function() {
		if (this.isLevelEnding)
			return;
		this.isLevelEnding = true;
		//log('flag pole hit');
		game.audio.stopBgMusic();
		game.audio.playSfx('flagpole');
		setTimeout(function() {game.audio.playSfx('stage_clear');}, 1250);
		//TODO need to move mario to other side of pole, and then into castle, and then vanish, then load next level


	};

	game.handleLevelHasEnded = function() {
		if (!this.isLevelEnding)
			return;
		this.isLevelEnding = false;
		//TODO check to see if we have another level to load?
		setTimeout(function() {game.loadLevel(currentLevel + 1, currentThemeNum, true);}, 7500);

	};

	game.showDebugUI = function() {
		$('#wrapper-debug').show();

		//dropdown with items that can be contained in hidden items
		var $selC = $('#selDebugBlockContents');
		var html = '';
		html += '<option value="0">empty</option>';
		html += '<option value="1">1up</option>';
		html += '<option value="2">Coin</option>';
		html += '<option value="3">Star</option>';
		html += '<option value="4">Mushroom</option>';
		html += '<option value="5">Flower</option>';
		html += '<option value="6">Mushroom or Flower</option>';
		html += '<option value="7">10-coin</option>';
		$selC.html(html);

		//dropdown with icons that can be painted
		var $selT = $('#selDebugTiles');
		html = '';
		html += '<option value="0">Default</option>';
		html += '<option value="-1">Solid Block</option>';
		html += '<option value="-2">Solid Top</option>';

		//we need to figure out what types of block icons we can paint
		var types = [];
		$.merge(types, game.blockTypesActivatedFromAnyDir);
		$.merge(types, game.blockTypesActivatedFromAbove);
		$.merge(types, game.blockTypesActivatedFromBelow);


		for (var i=0;i<game.blockMaps.length;i++)
		{
			var blockMapForLevel = game.blockMaps[i];
			if (!blockMapForLevel)
				continue;
			for (var b=0;b<blockMapForLevel.length;b++)
			{
				types.push(blockMapForLevel[b][0]);
			}
		}

		//remove duplicates
		var unique = [];
		$.each(types, function(i, e) {
			if ($.inArray(e, unique) == -1) unique.push(e);
		});
		unique.sort();

		for (var i=0;i<unique.length;i++)
		{
			html += '<option value="'+unique[i]+'">icon-'+unique[i]+'.gif</option>';
		}
		
		$selT.html(html);
	};

	game.hideDebugUI = function() {
		$('#wrapper-debug').hide();
	};

	game.handleSelDebugTilesChanged = function() {
		$('#imgDebugTile').attr("src", game.getLevelThemePath(currentLevel, currentThemeNum) + 'icon-'+$('#selDebugTiles').val()+'.gif');
	};

	game.debugOn = function() {
		game.isEditMode = true;
		game.showDebugUI();
		game.renderCollisionMap();
	};

	game.debugOff = function() {
		game.isEditMode = false;
		game.hideDebugUI();
		$(".js-debug-collisionmap-block").remove();
	};

	game.renderCollisionMap = function() {
		$(".js-debug-collisionmap-block").remove();
		var container = $("#background .level");
		
		var rowMax = game.collisionMaps[currentLevel].length - 1;
		for (var r=rowMax; r >= 0; r--) //render from bottom up
		{
			for (var c=0, cl = game.collisionMaps[currentLevel][r].length; c < cl; c++)
			{
				var h = '';
				for (var i=0;i<game.blockMaps[currentLevel].length;i++) {
					var block = game.blockMaps[currentLevel][i];	
					if (block[1] == r && block[2] == c) {
						h = 't:' + block[0]
						if (block[4])
							h += ', con:' + block[4];
					}
				}
				game.renderCollisionCell(currentLevel, r, c, rowMax, container, h);
			}
		}
	};
	game.renderCollisionCell = function (currentLevel, r, c, rowMax,container, extraHtmlContent) {
		
		var h = extraHtmlContent || '';
		if (h != '')
			h = ', ' + h;

		var div = $("<span class='js-debug-collisionmap-block location-r" + r +"-c" +  c + " debug-collisionmap-block value" + game.collisionMaps[currentLevel][r][c] + "'>" + r + "," + c + h + "</span>")
					.css("left", c * 16)
					.css("bottom", (rowMax - r + 1) * 16);
	    container.append(div);
	};

	game.exportCollisionMap = function(saveChanges) {
		if (saveChanges)
			game.saveChanges(true);
	
		var rowCount = game.collisionMaps[currentLevel].length;
		var s = 'game.collisionMaps['+currentLevel+'] = [';
		for (var r=0;r<rowCount;r++)
		{
			if (r > 0)
				s += ',';
			s += '[' + game.collisionMaps[currentLevel][r].toString() + ']';
		}
		s += '];'
		log(s);
	};

	game.exportBlockMaps = function () {

        var blockCount = game.blockMaps[currentLevel].length;
	    var s = 'game.blockMaps[' + currentLevel + '] = [';
	    for (var b = 0; b < blockCount; b++) {
	        if (b > 0) {
	            s += ',';
	        }

	        s += '[';
	        for (var i = 0; i < game.blockMaps[currentLevel][b].length; i++) {
	            if (i > 0) {
	                s += ',';
	            }
	            s += game.blockMaps[currentLevel][b][i];
	        }
	        s += ']';
	    }
	    s += '];'
	    log(s);
	};


	game.extendCollisionMap = function(colsLeft, colsRight, rowsTop, rowsBottom) {
		colsLeft = isNaN(colsLeft) ? 0 : parseInt(colsLeft,10);
		colsRight = isNaN(colsRight) ? 0 : parseInt(colsRight,10);
		rowsTop = isNaN(rowsTop) ? 0 : parseInt(rowsTop,10);
		rowsBottom = isNaN(rowsBottom) ? 0 : parseInt(rowsBottom,10);

		log('extendCollisionMap', colsLeft, colsRight, rowsTop, rowsBottom);

		if (colsLeft < 0) {
			//remove cols from the start
			log('TODO remove cols from the start');
		} else if (colsLeft > 0) {
			//add cols to the start
			for (var r=0, rowMax=game.collisionMaps[currentLevel].length; r < rowMax; r++)
				for (var i=0;i<colsLeft;i++)
					game.collisionMaps[currentLevel][r].unshift(0);
		} else {
			log('TODO handle extending this combination');
		}
		
	};

	game.moveToonRight = function() {
		lastActionTime = new Date().getTime();
		toonDir = 1;
	};

	game.moveToonLeft = function() {
		lastActionTime = new Date().getTime();
		toonDir = -1;
	};

	game.moveToonJump = function() {
		lastActionTime = new Date().getTime();
		if (onGround) {
			if (vel[1] != velMin[1])
				//TODO figure out if we should play jump-small or jump-super
				game.audio.playSfx('jump-small'); //we're not already queueing a jump
			vel[1] = velMin[1];
		}
	};

	game.stopToon = function() {
		lastActionTime = new Date().getTime();
		toonDir = 0;
	};

	game.stopToonIfMovingInDir = function(dir) {
		if (dir == toonDir)
			game.stopToon();
		else
			lastActionTime = new Date().getTime();
	};

	game.changeTheme = function(themeNum, crossfadeBgMusic) {
		var oldThemeNum = currentThemeNum;
		crossfadeBgMusic = !!crossfadeBgMusic;

		game.loadLevelBackground(currentLevel, themeNum);
		game.updateBlockSprites(currentLevel, themeNum);
		game.setToonSpriteSet(currentToonNum, currentLevel, themeNum);
	
		if (crossfadeBgMusic)
			game.audio.crossFadeTracks(game.audio.getAudioKey('bg', currentLevel, oldThemeNum), game.audio.getAudioKey('bg', currentLevel, themeNum), 1.0) 

	};

	game.saveChanges = function(saveCollisionMaps) {
		$.localStorage("toon-position", scrollPosX + "," + pos[0] + "," + pos[1]);
		if(saveCollisionMap)
			$.localStorage('collisionMaps', game.collisionMaps);
	};

	game.audio.getAudioKey = function(type, levelNum, themeNum) {
		var level = (levelNum || currentLevel);
		var theme = (themeNum || currentThemeNum);
		return type + '_' + level + '_' + theme;
	};

	game.audio.loadSound = function(url, key, isLooping) {
		//load a sound given a url
		var request = new XMLHttpRequest();
		request.open('GET', url, true);
		request.responseType = 'arraybuffer';

		game.audio.sounds[key] = {};
		game.audio.sounds[key].isLoaded = false;
		game.audio.sounds[key].loadStartedAt = new Date().getTime();
		game.audio.sounds[key].isLooping = !!isLooping;
		
		// Decode asynchronously
		request.onload = function() {
			game.audio.context.decodeAudioData(request.response, function(buffer) {
				//success
				game.audio.sounds[key].buffer = buffer;
				game.audio.sounds[key].isLoaded = true;
				game.audio.sounds[key].loadStoppedAt = new Date().getTime();
				game.audio.sounds[key].isError = false;
				log('sound loaded', key, url, (game.audio.sounds[key].loadStoppedAt - game.audio.sounds[key].loadStartedAt) + 'ms');
			}, function(err) {
				//error
				log('onAudioLoadError', key, url, err);
				game.audio.sounds[key].loadStoppedAt = new Date().getTime();
				game.audio.sounds[key].isError = true;
			});
		}
		request.send();
	};

	game.audio.playSound = function(soundKey, gainVolume, startAtTime) {
		var sound = game.audio.sounds[soundKey];
		if (!sound || !sound.isLoaded)
		{
			log('game.audio.playSound cannot play ['+soundKey+'] because it is not loaded yet', sound);
			return sound;
		}

		var result = game.audio.playBuffer(sound.buffer, sound.isLooping, gainVolume, startAtTime);
		game.audio.sounds[soundKey].gainNode = result.gainNode;
		game.audio.sounds[soundKey].source = result.source;
		return game.audio.sounds[soundKey];
	};

	game.audio.playBuffer = function(buffer, isLooping, gainVolume, startAtTime) {
		startAtTime = startAtTime || 0;
		if (isNaN(gainVolume))
			gainVolume = 1;

		var source = game.audio.context.createBufferSource();	// creates a sound source
		var gainNode = game.audio.context.createGain();			// create a gain node attached to the AudioContext
		gainNode.connect(game.audio.context.destination);		// Connect gain to destination (speakers)
		gainNode.gain.value = gainVolume;						// default volume

		source.loop = !!isLooping;								// loops or not
		source.buffer = buffer;									// tell the source which sound to play
		source.connect(gainNode);								// connect the source to gain node so we can mess with the volume in advanced ways
		source.start(startAtTime);								// play the source now, starting at the given time (or 0=beginning) ... // note: on older systems, may have to use deprecated noteOn(time);
		
		return { source: source, gainNode: gainNode };
	};

	game.audio.stopSound = function(soundKey) {
		if (game.audio.sounds[soundKey] && game.audio.sounds[soundKey].source && game.audio.sounds[soundKey].source.playbackState == 2) {
			//UNSCHEDULED_STATE (0), SCHEDULED_STATE (1), PLAYING_STATE (2), or FINISHED_STATE (3).
			game.audio.sounds[soundKey].source.stop(game.audio.context.currentTime);
			return true;
		}
		return false;
	};

	game.audio.isPlaying = function(soundKey) {
		if (game.audio.sounds[soundKey] && game.audio.sounds[soundKey].source && game.audio.sounds[soundKey].source.playbackState == 2) {
			return true;
		}
		return false;
	};

	game.audio.playSfx = function(nameKey, levelNum, themeNum) {
		game.audio.playSound(game.audio.getAudioKey(nameKey, levelNum, themeNum));
	};

	game.audio.playBgMusic = function(levelNum, themeNum) {
		game.audio.playSfx('bg',levelNum, themeNum);
	};

	game.audio.stopBgMusic = function() {
		var soundKey = game.audio.getAudioKey('bg');
		if (game.audio.isPlaying(soundKey))
			game.audio.stopSound(soundKey);
	};

	game.audio.toggleBgMusic = function() {
		var soundKey = game.audio.getAudioKey('bg');
		if (game.audio.isPlaying(soundKey))
			game.audio.stopSound(soundKey);
		else
			game.audio.playSound(soundKey);
	};

	game.audio.crossFadeTracks = function(audioKeyToStop, audioKeyToStart, fadeSeconds) {
		var soundToStop  = game.audio.sounds[audioKeyToStop];
		var soundToStart = game.audio.sounds[audioKeyToStart];
		if (isNaN(fadeSeconds))
			fadeSeconds = 1.0;

		//fade current sound out
		if (soundToStop.gainNode) {
			soundToStop.gainNode.gain.linearRampToValueAtTime(1, game.audio.context.currentTime);
			soundToStop.gainNode.gain.linearRampToValueAtTime(0, game.audio.context.currentTime + fadeSeconds);
		}
		if (soundToStop.source)
			soundToStop.source.stop(game.audio.context.currentTime + fadeSeconds);

		//start new sounds at 0 volume
		soundToStart = game.audio.playSound(audioKeyToStart, 0);
		soundToStart.gainNode.gain.linearRampToValueAtTime(0, game.audio.context.currentTime);
		soundToStart.gainNode.gain.linearRampToValueAtTime(1, game.audio.context.currentTime + fadeSeconds);

	};


	game.renderFont = function(text, x, y, containerId) {
		//log('renderFont', text, x, y);

		var html = '<div class="sprite" ';
		if (containerId)
			html += 'id="' + containerId + '" ';
		html += '>';

		var font = levels[currentLevel].themes[currentThemeNum].font;

		if (typeof text !== 'undefined')
		{
			for (var i=0;i<text.length;i++ )
			{
				var asciiCode = text.charCodeAt(i);
				html += game.getFontImageHtmlForAsciiCode(asciiCode, font);
			}
		}
		
		html += '</div>'
		$html = $(html);
		$level.append($html)
		$html.css("top", y).css("left", x);
	};

	game.getFontImageHtmlForAsciiCode = function (asciicode, font) {
		font = font || levels[currentLevel].themes[currentThemeNum].font;

		//font: {filename:'font.png', codeOffset:32, height:8, width:8, rows:4, cols:16},
		var src = game.getLevelThemePath(currentLevel, currentThemeNum) + font.filename;
		
		if (font.convertLowerToUpper && asciicode >= 97 && asciicode <= 122)
			asciicode = asciicode - 32;

		var index = asciicode - font.codeOffset;
		var col = index % font.cols;
		var row = (index / font.cols)|0;
		var x = - col * font.width;
		var y = - row * font.height;

		//log('getFontImageHtmlForAsciiCode', font, asciicode, index, col, row, x, y);

		var html = '<img src="clear.gif" class="sprite" style="position:relative;height:'+font.height+'px;width:'+font.width+'px;';
		html += 'background-image:url('+src+');background-position:'+x+'px '+y+'px;background-repeat:no-repeat"/>';
		return html;
	};


	game.renderTextBox = function(id, text, row, col, colWidth) {
		$("#" + id).remove();

		var rowMax = game.collisionMaps[currentLevel].length - 1;

		var container = $("<div class='sprite js-wrapper-textbox wrapper-textbox wrapper-textbox-theme"+currentThemeNum+"' id='"+id+"'>"+text+"</div>")
			.css('max-width', (colWidth * 16))
			.css("left",   col*16)
			.css("bottom", (rowMax - row + 1)*16);
		;

		/*
		var container = $("<div class='sprite js-wrapper-textbox wrapper-textbox' id='"+id+"'></div>");

		//TODO calc text & box size
		//TODO draw border
		//TODO draw text

		var pxPerLetter = 8;
		var pxPerBorder = 8;
		var pxPerCol = 16;


		var letterCount = text.length;
		var textWidthPx = pxPerLetter * letterCount;
		var maxPxPerLine = colWidth * 16;
		var lines = Math.ceil(letterCount / maxPxPerLine);
		var bordersWide = maxPxPerLine / pxPerBorder;
		
		var c = col;
		var r = row;

		//TL: TOP LEFT BORDER
		var bordertl = $("<img class='sprite js-textbox-border' src='"+game.getLevelThemePath(currentLevel, currentThemeNum)+"box-tl.png' />")
			.css("left",   c*16)
			.css("bottom", (rowMax - r + 1)*16);
		container.append(bordertl);

		//T: TOP BORDER
		for (var i=0;i<bordersWide;i++)
		{
			var border = $("<img class='sprite js-textbox-border' src='"+game.getLevelThemePath(currentLevel, currentThemeNum)+"box-t.png' />")
				.css("left",   ((c*2) + 1 + i)*pxPerBorder)
				.css("bottom", (rowMax - r + 1)*16);
			container.append(border);
		}

		//TR: TOP RIGHT BORDER
		var bordertr = $("<img class='sprite js-textbox-border' src='"+game.getLevelThemePath(currentLevel, currentThemeNum)+"box-tr.png' />")
			.css("left",   (c + colWidth) * 16)
			.css("bottom", (rowMax - r + 1) * 16);
		container.append(bordertr);



		for (var r=rowMax; r >= 0; r--) //render from bottom up
		{
			for (var c=0, cl = game.collisionMaps[currentLevel][r].length; c < cl; c++)
			{
				var div = $("<span class='js-debug-collisionmap-block debug-collisionmap-block value"+game.collisionMaps[currentLevel][r][c]+"'>"+r+","+c+"</span>")
					.css("left", c*16)
					.css("bottom", (rowMax - r + 1)*16);
				//container.append(div);
			}
		}

		*/

		$("#background .level").append(container);
	};



	function initAudio() {
		window.AudioContext = window.AudioContext||window.webkitAudioContext;
		game.audio.context = new AudioContext();

		//load all of the bg music sounds for a level
		for (var i=0;i<levels.length;i++) {
			var level = levels[i];
			if (!level)
				continue;
			var levelNum = i;
			for (var t=0;t<level.themes.length;t++)
			{
				var theme = level.themes[t];
				for	(var a=0;a<theme.audio.length;a++) {
					var audio = theme.audio[a];
					game.audio.loadSound((game.getLevelThemePath(levelNum, t) + audio.filename), game.audio.getAudioKey(audio.key, levelNum, t), audio.isLooping);
				}
			}
		}
	}



	game.handleMouseDownEvent = function(e) {
		if (!game.isEditMode)
			return true;

		// record the starting position for later
		if (!mouse[e.which])
			mouse[e.which] = {};
	
		mouse[e.which].xStart = e.pageX;
		mouse[e.which].yStart = e.pageY;
			
		switch (e.which) {
			case 1:
				//alert('Left mouse button pressed');
				break;
			case 2:
				//alert('Middle mouse button pressed');
				break;
			case 3:
				//alert('Right mouse button pressed');

				break;
			default:
				//alert('Unknown mouse button pressed:' + e.which);
		}


		// Using return false prevents browser's default,
		// often unwanted mousemove actions (drag & drop)
		return false;
	};

	game.handleMouseUpEvent = function(e) {
		///user has let up on the mouse button - let's take action
		if (!mouse[e.which])
			mouse[e.which] = {};
	
		mouse[e.which].xEnd = e.pageX; //x/16 ~ cols
		mouse[e.which].yEnd = e.pageY; //y/16 ~ rows

		var rowsShowing = $(window).height()/16; //don't trunc the partial
		var deadColMapRows = rowsShowing - game.collisionMaps[currentLevel].length; //amount of 'extra' rows showing above our collisionMap area of the level

		//relative to the current screen scroll...so these start at 0,0 even if we are halfway through the level
		var margin = 0; //margin makes single clicks miss when near the edge
		relColStart = Math.floor((margin + mouse[e.which].xStart) / 16);
		relRowStart = Math.floor((margin + mouse[e.which].yStart - (deadColMapRows*16)) / 16);
		relColEnd = Math.floor((margin + mouse[e.which].xEnd) / 16);
		relRowEnd = Math.floor((margin + mouse[e.which].yEnd - (deadColMapRows*16)) / 16);

		var curScrollCol = Math.round(scrollPosX/16);

		absColStart = curScrollCol + relColStart;
		absRowStart = relRowStart;
		absColEnd = curScrollCol + relColEnd;
		absRowEnd = relRowEnd;
		
		var spritesWide = Math.max(1, Math.abs(absColEnd - absColStart));
		var spritesTall = Math.max(1, Math.abs(absRowEnd - absRowStart));
		
		if (game.isEditMode) {

			log('mouseup:all', mouse, ['pixels x/y,s/e:', mouse[e.which].xStart, mouse[e.which].xEnd, mouse[e.which].yStart, mouse[e.which].yEnd].toString(), ['rel r/c,s/e:', relRowStart, relRowEnd, relColStart, relColEnd].toString(), ['abs r/c,s/e:', absRowStart, absRowEnd, absColStart, absColEnd].toString(), e);

			//log('mouseup', ['pixels', mouseStart_x, mouseStart_y, mouseEnd_x, mouseEnd_y, e]);
			//log('mouseup', ['rel cols', relColStart, relRowStart, relColEnd, relRowEnd, e]);
			//log('mouseup', ['abs cols', absColStart, absRowStart, absColEnd, absRowEnd, e]);


			if (spritesWide > 0 && spritesTall > 0)
			{
				var value = e.which == 3 ? 0 : 1; //left click = add, right click = remove
				var startCol = absColStart > absColEnd ? absColEnd : absColStart;
				var startRow = absRowStart > absRowEnd ? absRowEnd : absRowStart;
				var endCol = startCol + spritesWide;
				var endRow = startRow + spritesTall;

				log('selected', 'width:' + spritesWide, 'height:' + spritesTall, 'startRow/Col:' + startRow + ',' + startCol, 'end Row/Col:' + endRow + ',' + endCol);

				if (startRow >= 0)
				{

				    var container = $("#background .level");
				    var rowMax = game.collisionMaps[currentLevel].length - 1;

				  var paintType= $('#selDebugTiles option:selected').val();
				  var containsItemTypeId = $('#selDebugBlockContents option:selected').val();

					for (var r=startRow;r<endRow;r++)
					{
						for (var c=startCol;c<endCol;c++)
						{
						    game.removeBlockAt(r, c);                   
				
							//NOTE need one case for hardcoded defaults <=0, plus each blockType
						    switch (parseInt(paintType)) {
                                //remove collision 
						        case 0:
						            game.collisionMaps[currentLevel][r][c] = 0;
						            break;
						        case -1:
						            //solid block
						            game.collisionMaps[currentLevel][r][c] = 1;
						            break;
                                case -2:
                                    //top block
                                    game.collisionMaps[currentLevel][r][c] = 2;
                                    break;

	//Components are: [blockType, row, col, isDisabled, containsItemTypeId={1=1up,2=coin,3=star,4=mushroom,5=flower,6=mushroom or flower, 7=10 coin},isInvisible]
	//blockTypes: 1=?, 2=coin, 3=red brick, 4=P, 5=End-level Star/Flower/Mushroom anim, 6=1up, 7=music note, 8=empty block, 9=star, 10=flagpole, 11=blue brick, 12=spinning coin

                                case 1:
                                    //qmark block
                                    game.collisionMaps[currentLevel][r][c] = 1;
                                    game.blockMaps[currentLevel].push([1, r, c, false, containsItemTypeId, false]);
                                    game.loadLevelBlock(currentLevel, currentThemeNum, game.blockMaps[currentLevel].length-1, game.collisionMaps[currentLevel].length);
                                    break;
                                case 2:
                                    //coin block
                                    game.collisionMaps[currentLevel][r][c] = 2;
                                    game.blockMaps[currentLevel].push([2, r, c, false, 0, false]);
                                    game.loadLevelBlock(currentLevel, currentThemeNum, game.blockMaps[currentLevel].length-1, game.collisionMaps[currentLevel].length);
                                    break;
                                case 3:
                                    //red brick block
                                    game.collisionMaps[currentLevel][r][c] = 1;
                                    game.blockMaps[currentLevel].push([3, r, c, false, containsItemTypeId, false]);
                                    game.loadLevelBlock(currentLevel, currentThemeNum, game.blockMaps[currentLevel].length-1, game.collisionMaps[currentLevel].length);
                                    break;
                                case 4:
                                    //"P" block
                                    game.collisionMaps[currentLevel][r][c] = 1;
                                    game.blockMaps[currentLevel].push([4, r, c, false, 0, false]);
                                    game.loadLevelBlock(currentLevel, currentThemeNum, game.blockMaps[currentLevel].length-1, game.collisionMaps[currentLevel].length);
                                    break;
                                case 5:
                                    //End-level Star/Flower/Mushroom anim
                                    game.collisionMaps[currentLevel][r][c] = 1;
                                    game.blockMaps[currentLevel].push([5, r, c, false, 0, false]);
                                    game.loadLevelBlock(currentLevel, currentThemeNum, game.blockMaps[currentLevel].length-1, game.collisionMaps[currentLevel].length);
                                    break;
                                case 6:
                                    //1up block
                                    game.collisionMaps[currentLevel][r][c] = 2;
                                    game.blockMaps[currentLevel].push([6, r, c, false, 0, false]);
                                    game.loadLevelBlock(currentLevel, currentThemeNum, game.blockMaps[currentLevel].length-1, game.collisionMaps[currentLevel].length);
                                    break;
                                case 7:
                                    //music block
                                    game.collisionMaps[currentLevel][r][c] = 2;
                                    game.blockMaps[currentLevel].push([7, r, c, false, 0, false]);
                                    game.loadLevelBlock(currentLevel, currentThemeNum, game.blockMaps[currentLevel].length-1, game.collisionMaps[currentLevel].length);
                                    break;
                                case 8:
                                    //empty block
                                    game.collisionMaps[currentLevel][r][c] = 2;
                                    game.blockMaps[currentLevel].push([8, r, c, false, 0, false]);
                                    game.loadLevelBlock(currentLevel, currentThemeNum, game.blockMaps[currentLevel].length-1, game.collisionMaps[currentLevel].length);
                                    break;
                                case 9:
                                    //star block
                                    game.collisionMaps[currentLevel][r][c] = 2;
                                    game.blockMaps[currentLevel].push([9, r, c, false, 0, false]);
                                    game.loadLevelBlock(currentLevel, currentThemeNum, game.blockMaps[currentLevel].length-1, game.collisionMaps[currentLevel].length);
                                    break;
                                case 10:
                                    //flagpole 
                                    game.collisionMaps[currentLevel][r][c] = 2;
                                    game.blockMaps[currentLevel].push([10, r, c, false, 0, false]);
                                    game.loadLevelBlock(currentLevel, currentThemeNum, game.blockMaps[currentLevel].length-1, game.collisionMaps[currentLevel].length);
                                    break;
                                case 11:
                                    //blue brick block
                                    game.collisionMaps[currentLevel][r][c] = 1;
                                    game.blockMaps[currentLevel].push([11, r, c, false, containsItemTypeId, false]);
                                    game.loadLevelBlock(currentLevel, currentThemeNum, game.blockMaps[currentLevel].length-1, game.collisionMaps[currentLevel].length);
                                    break;
                                case 12:
                                    //spinning stationary coin
                                    game.collisionMaps[currentLevel][r][c] = 1;
                                    game.blockMaps[currentLevel].push([12, r, c, false, containsItemTypeId, false]);
                                    game.loadLevelBlock(currentLevel, currentThemeNum, game.blockMaps[currentLevel].length-1, game.collisionMaps[currentLevel].length);
                                    break;
							}
						    
							//rerender the map

						    var container = $("#background .level");
						    container.find(".location-r" + r + "-c" + c).remove();	
							var h = 't:' + paintType;
							if (containsItemTypeId)
								h += ', con:' + containsItemTypeId;					
							game.renderCollisionCell(currentLevel, r, c, rowMax, container, h);
						}
					}
				}

			} else {
				log('no selection', 'width', spritesWide, 'height', spritesTall, 'startRow: ' + startRow);
			}

		} else {
			//not in debug mode...in presentation mode
			
			//right click...let's place the toon at the location clicked
			if (e.which == 3)
				game.setToonPosition(absColEnd, absRowEnd);
			
		}

		// Using return false prevents browser's default,
		// often unwanted mousemove actions (drag & drop)
		return false;
	};

	game.removeBlockAt = function (row, collumn) {
	    for (var b = 0; b < game.blockMaps[currentLevel].length; b++) {
	        if (game.blockMaps[currentLevel][b][1] == row && game.blockMaps[currentLevel][b][2] == collumn) {
	           var selector = '.block-r' + game.blockMaps[currentLevel][b][1] + 'c' + game.blockMaps[currentLevel][b][2];
	           $(selector).remove();
	           game.blockMaps[currentLevel].splice(b, 1);
	        }
	    }
	}

	game.handleKeyDown = function(keyCode) {
		//log(keyCode)
		switch (keyCode) {
			case 39: // right
				if (!this.isLevelEnding)
					game.moveToonRight();
				break;
			case 37: // left
				if (!this.isLevelEnding)
					game.moveToonLeft();
				break;
			case 38: // up
				if (!this.isLevelEnding)
					game.moveToonJump();
				break;
		}

	};

	game.handleKeyUp = function(keyCode) {
		//if (game.isEditMode)
		//	log(keyCode);
		
		switch (keyCode) {
			case 39: // right
				game.stopToonIfMovingInDir(1);
				break;
			case 37: // left
				game.stopToonIfMovingInDir(-1);
				break;

		}

		keyQueue.push(keyCode);
		while (keyQueue.length > keyQueueMax)
			keyQueue.shift(); //remove the beginning

		keyQueueString = keyQueue.toString();
		if (keyQueueString.indexOf("38,38,40,40,37,39,37,39,66,65") >= 0)
		{
			//TODO konami code - up, up, down, down, left, right, left, right, b, a
			log('30 free lives');
			keyQueue = [];
		} else if (keyQueueString.indexOf("56,66,73,84") >= 0) {
			//8bit
			game.changeTheme(1, true);
			keyQueue = [];
		} else if (keyQueueString.indexOf("49,54,66,73,84") >= 0) {
			//16bit
			game.changeTheme(1, true);
			keyQueue = [];
		} else if (keyQueueString.indexOf("77,65,82,73,79") >= 0) {
			//mario
			game.setToonSpriteSet(0);
			keyQueue = [];
		} else if (keyQueueString.indexOf("76,85,73,71,73") >= 0) {
			//luigi
			game.setToonSpriteSet(1);
			keyQueue = [];
		} else if (keyQueueString.indexOf("68,69,66,85,71,79,78") >= 0) {
			//debugon
			game.debugOn();
			keyQueue = [];
		} else if (keyQueueString.indexOf("68,69,66,85,71,79,70,70") >= 0) {
			//debugoff
			game.debugOff(1)
			keyQueue = [];
		}

		if (game.isEditMode) {
			//log(keyQueue.toString());
			if (keyCode >= 48 && keyCode <= 57) //0-9
			{
				var x = Math.abs(48-keyCode);
				//pressed a number...in debug mode...let's select that tile in the painter
				$("#selDebugTiles option").each(function(i, el) { el.selected = (el.value == x);});
				$('#selDebugTiles').change();
			}
		}
	};



	//EVENT WIREUP

	$(document).keydown(function(e) {
		game.handleKeyDown(e.which);
	});

	$(document).keyup(function(e) {
		game.handleKeyUp(e.which);
	});

	$(window).bind("resize", function() {
		$background.scrollLeft(scrollPosX);
	});

	$(window).bind("unload", function() {
		game.saveChanges();
	});

	$level.bind("contextmenu",function(e) {
		//game.handleMouseUpEvent(e); 
		e.preventDefault();

		// create and show menu
		return true;
	});

	$level.mousedown(function(e) {
		return game.handleMouseDownEvent(e);
	});

	$level.mouseup(function(e) {
		return game.handleMouseUpEvent(e);
	});

	//END EVENT WIREUP



	game.setToonSpriteSet(1); //this chooses which toon sprite set we are using (mario/luigi/etc)
	game.loadLevel(1); 
	game.buildSlides();
	initAudio();
	setInterval(mainLoop, 1000/20); // 20 is decent
	lastActionTime = new Date().getTime();
	setInterval(checkIdle, 1000);


	if (game.isEditMode)
		game.renderCollisionMap();
	

}); //end of private onload func




</script>

</html>
